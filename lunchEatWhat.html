<span style="font-size:26px;font-family:Microsoft JhengHei;"><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>中午吃啥咪</TITLE>
 <script type="text/javascript" src="js/bk.js"></script>
 <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <SCRIPT LANGUAGE="JavaScript">
var names = [
"不2糖",
"喬記",
"越南",
"醉雞(家鄉牛肉麵)",
"刀削麵",
"蚵仔之家",
"白菜小姐",
"麻婆公子",
"711"
];
var time;
function begin(){
document.getElementById("btnBegin").disabled = true;
chouqian();
document.getElementById("btnEnd").disabled = false;
}
function chouqian(){
var index = Math.floor(Math.random()*1000 % names.length);
var name = names[index];
document.getElementById("result").innerHTML = name;
time = window.setTimeout(chouqian,2);
}
function end(){
window.clearTimeout(time);
document.getElementById("btnBegin").disabled = false;
swal("恭喜!!", $('#name').val()+'決定要吃 : '+$('#result').text(), "success");
document.getElementById("btnEnd").disabled = true;
}
function start(){
let name = $('#name').val();
let password = $('#password').val();
name = name.trim();
if(name==''){
swal("錯誤!", "請輸入姓名!!", "warning");
}if(password==''){
swal("錯誤!", "請輸入密碼!!", "warning");
}if(name != '' && password != ''){
    fetch('https://troyluuu.github.io/test/data/key.json').then(function(response) {
    return response.text()
  }).then(function(text) {
 var json = JSON.parse(text);
      let result = 'F';
      for(var key in json){
      if(json[key].a == name && json[key].p == password){
       result = 'S';
       $('#nameDiv').hide();
       $('#lunchDiv').show();
      }
      if(result == 'F'){
       swal("錯誤!", "帳號或密碼錯誤,請重新輸入,謝謝!!", "warning");
      }
}
  }).catch(function(err) {
      // Error :(
       swal("錯誤!", name + password + "系統發生錯誤,請再試一次,謝謝!!", "warning");
  })
}else{
   swal("錯誤!", "帳號或密碼空白,請重新輸入,謝謝!!", "warning");
}
}
function findMovie(){
  swal({
  text: '輸入您想查詢的電影 例如:Toys story".',
  content: "input",
  button: {
    text: "Search!",
    closeModal: false,
  },
})
.then(name => {
  if (!name) throw null;
 
  return fetch('https://itunes.apple.com/search?term=${name}&entity=movie');
})
.then(results => {
  return results.json();
})
.then(json => {
  const movie = json.results[0];
 
  if (!movie) {
    return swal("很抱歉,沒有找到符合的項目!");
  }
 
  const name = movie.trackName;
  const imageURL = movie.artworkUrl100;
 
  swal({
    title: "Top result:",
    text: name,
    icon: imageURL,
  });
})
.catch(err => {
  if (err) {
    swal("Oh noes!", "The AJAX request failed!", "error");
  } else {
    swal.stopLoading();
    swal.close();
  }
});
}
 </SCRIPT>
</HEAD>
 
<BODY>
<div style="text-align:center;margin-top:100px">
<h1>中午吃啥咪</h1>
 <div id="nameDiv">
 帳號:<INPUT TYPE="text" placeholder="請輸入帳號" VALUE="" id="name"><br>
 密碼:<INPUT TYPE="text" placeholder="請輸入密碼" VALUE="" id="password"> 
 <INPUT TYPE="button" VALUE="送出" ONCLICK="start();"> 
 </div>
 <div id="lunchDiv" style="display:none">
<h3 id="result" style="color:blue"></h3>
<INPUT TYPE="button" VALUE="開始" id="btnBegin" ONCLICK="begin();"> 
<INPUT TYPE="button" VALUE="結束" id="btnEnd" ONCLICK="end();" disabled><br><br>
<INPUT TYPE="button" VALUE="查詢電影" id="btnMovie" ONCLICK="findMovie();">
 </div>
</div>
</BODY>
</HTML></span>
